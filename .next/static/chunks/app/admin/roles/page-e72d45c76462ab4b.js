(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[717],{6989:function(e,s,t){Promise.resolve().then(t.bind(t,7137))},7137:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var l=t(7437),r=t(9294),i=t(9376),n=t(2265),a=t(7648);function o(){let{user:e,loading:s}=(0,r.a)(),t=(0,i.useRouter)(),[o,c]=(0,n.useState)([]),[d,m]=(0,n.useState)([]),[u,x]=(0,n.useState)(!0),[h,g]=(0,n.useState)(null),p=[{role:"ADMIN",name:"Administrator",description:"Full system access, user management, system configuration",color:"bg-red-100 text-red-800 border-red-200",level:5,permissions:["Manage all users and roles","Configure system settings","Access all modules","View audit logs","Manage email configuration"]},{role:"OVERSEER",name:"Overseer",description:"Department oversight, assignment management, event coordination",color:"bg-blue-100 text-blue-800 border-blue-200",level:4,permissions:["Manage events and assignments","View department reports","Assign attendants to positions","Access oversight tools"]},{role:"ASSISTANT_OVERSEER",name:"Assistant Overseer",description:"Limited oversight capabilities, assist with assignments",color:"bg-purple-100 text-purple-800 border-purple-200",level:3,permissions:["Assist with event management","View assignment reports","Help coordinate attendants"]},{role:"KEYMAN",name:"Keyman",description:"Key position assignments, special access areas",color:"bg-yellow-100 text-yellow-800 border-yellow-200",level:2,permissions:["Access key positions","Manage special assignments","View position-specific data"]},{role:"ATTENDANT",name:"Attendant",description:"Standard user, view personal assignments and availability",color:"bg-green-100 text-green-800 border-green-200",level:1,permissions:["View personal assignments","Update availability","Access basic profile"]}];(0,n.useEffect)(()=>{if(!s){if(!e||"ADMIN"!==e.role){t.push("/unauthorized");return}v()}},[e,s,t]);let v=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let s=await e.json();c(s),b(s)}}catch(e){console.error("Failed to fetch users:",e)}finally{x(!1)}},b=e=>{let s={};p.forEach(e=>{s[e.role]={role:e.role,count:0,activeCount:0,users:[]}}),e.forEach(e=>{s[e.role]&&(s[e.role].count++,s[e.role].users.push(e),e.isActive&&s[e.role].activeCount++)}),m(Object.values(s))};return s||u?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("div",{className:"text-lg",children:"Loading..."})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsx)("div",{className:"container mx-auto px-4 max-w-6xl",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Role Management"}),(0,l.jsx)(a.default,{href:"/admin",className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Back to Admin"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Role Hierarchy & Permissions"}),(0,l.jsx)("div",{className:"space-y-4",children:p.map(e=>{let s=d.find(s=>s.role===e.role);return(0,l.jsx)("div",{className:"border-2 rounded-lg p-4 cursor-pointer transition-all ".concat(h===e.role?"ring-2 ring-blue-500 "+e.color:e.color),onClick:()=>g(h===e.role?null:e.role),children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,l.jsxs)("span",{className:"text-2xl font-bold",children:["Level ",e.level]}),(0,l.jsx)("h3",{className:"text-lg font-semibold",children:e.name}),(0,l.jsxs)("span",{className:"px-2 py-1 rounded text-xs bg-white bg-opacity-50",children:[(null==s?void 0:s.activeCount)||0," active / ",(null==s?void 0:s.count)||0," total"]})]}),(0,l.jsx)("p",{className:"text-sm mb-3",children:e.description}),h===e.role&&(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold mb-2",children:"Permissions:"}),(0,l.jsx)("ul",{className:"text-sm space-y-1",children:e.permissions.map((e,s)=>(0,l.jsxs)("li",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-green-600 mr-2",children:"✓"}),e]},s))})]}),s&&s.users.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold mb-2",children:"Users with this role:"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.users.map(e=>(0,l.jsxs)("div",{className:"text-sm bg-white bg-opacity-50 p-2 rounded",children:[(0,l.jsxs)("span",{className:"font-medium",children:[e.firstName," ",e.lastName]}),(0,l.jsx)("span",{className:"ml-2 px-1 rounded text-xs ".concat(e.isActive?"bg-green-200 text-green-800":"bg-red-200 text-red-800"),children:e.isActive?"Active":"Inactive"})]},e.id))})]})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:(null==s?void 0:s.count)||0}),(0,l.jsx)("div",{className:"text-xs",children:"users"})]})]})},e.role)})})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Role Distribution"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:p.map(e=>{let s=d.find(s=>s.role===e.role),t=o.length>0?(((null==s?void 0:s.count)||0)/o.length*100).toFixed(1):"0";return(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null==s?void 0:s.count)||0}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:e.name}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[t,"% of users"]}),(0,l.jsx)("div",{className:"mt-2 bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:"".concat(t,"%")}})})]},e.role)})})]}),(0,l.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-semibold text-yellow-800 mb-2",children:"⚠️ Bulk Role Operations"}),(0,l.jsx)("p",{className:"text-yellow-700 text-sm mb-4",children:"Use these operations carefully. They will change roles for multiple users at once."}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-yellow-800 mb-1",children:"From Role:"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border border-yellow-300 rounded-md text-sm",children:[(0,l.jsx)("option",{value:"",children:"Select source role..."}),p.map(e=>{var s;return(0,l.jsxs)("option",{value:e.role,children:[e.name," (",(null===(s=d.find(s=>s.role===e.role))||void 0===s?void 0:s.count)||0," users)"]},e.role)})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-yellow-800 mb-1",children:"To Role:"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border border-yellow-300 rounded-md text-sm",children:[(0,l.jsx)("option",{value:"",children:"Select target role..."}),p.map(e=>(0,l.jsx)("option",{value:e.role,children:e.name},e.role))]})]})]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 text-sm",disabled:!0,children:"Execute Bulk Role Change (Coming Soon)"})})]})]})})})}},9294:function(e,s,t){"use strict";t.d(s,{Providers:function(){return a},a:function(){return n}});var l=t(7437),r=t(2265);let i=(0,r.createContext)(void 0);function n(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a(e){let{children:s}=e,[t,n]=(0,r.useState)(null),[a,o]=(0,r.useState)(!0);(0,r.useEffect)(()=>{c()},[]);let c=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let s=await e.json();n(s.user)}}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}},d=async(e,s)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:s})});if(t.ok){let e=await t.json();return n(e.user),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},m=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),n(null)}catch(e){console.error("Logout failed:",e)}};return(0,l.jsx)(i.Provider,{value:{user:t,loading:a,login:d,logout:m},children:s})}},9376:function(e,s,t){"use strict";var l=t(5475);t.o(l,"useRouter")&&t.d(s,{useRouter:function(){return l.useRouter}}),t.o(l,"useSearchParams")&&t.d(s,{useSearchParams:function(){return l.useSearchParams}})}},function(e){e.O(0,[981,971,117,744],function(){return e(e.s=6989)}),_N_E=e.O()}]);