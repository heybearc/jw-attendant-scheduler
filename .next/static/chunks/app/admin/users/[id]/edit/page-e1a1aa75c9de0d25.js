(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[648],{725:function(e,t,a){Promise.resolve().then(a.bind(a,8921))},8921:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(7437),r=a(9294),n=a(9376),i=a(2265),l=a(7648);function o(e){let{params:t}=e,{user:a,loading:o}=(0,r.a)(),c=(0,n.useRouter)(),[d,u]=(0,i.useState)(null),[h,m]=(0,i.useState)(!0),[x,f]=(0,i.useState)(!1),[p,g]=(0,i.useState)({email:"",firstName:"",lastName:"",phone:"",role:"ATTENDANT",isActive:!0});(0,i.useEffect)(()=>{if(!o){if(!a||"ADMIN"!==a.role){c.push("/unauthorized");return}y()}},[a,o,c,t.id]);let y=async()=>{try{let a=await fetch("/api/admin/users/".concat(t.id));if(a.ok){var e;let t=await a.json();u(t),g({email:t.email||"",firstName:t.firstName||"",lastName:t.lastName||"",phone:t.phone||"",role:t.role||"ATTENDANT",isActive:null===(e=t.isActive)||void 0===e||e})}else 404===a.status&&(alert("User not found"),c.push("/admin"))}catch(e){console.error("Failed to fetch user:",e),alert("Failed to load user data")}finally{m(!1)}},b=async e=>{e.preventDefault(),f(!0);try{let e=await fetch("/api/admin/users/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(e.ok)alert("User updated successfully!"),c.push("/admin");else{let t=await e.json();alert("Failed to update user: ".concat(t.error))}}catch(e){console.error("Failed to update user:",e),alert("Failed to update user")}finally{f(!1)}},v=async()=>{if(confirm("Are you sure you want to deactivate this user? This action will set their status to inactive."))try{let e=await fetch("/api/admin/users/".concat(t.id),{method:"DELETE"});if(e.ok)alert("User deactivated successfully!"),c.push("/admin");else{let t=await e.json();alert("Failed to deactivate user: ".concat(t.error))}}catch(e){console.error("Failed to deactivate user:",e),alert("Failed to deactivate user")}};return o||h?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading..."})}):d?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsx)("div",{className:"container mx-auto px-4 max-w-2xl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Edit User"}),(0,s.jsx)(l.default,{href:"/admin",className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Back to Admin"})]}),d.inviteToken&&d.inviteExpiry&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded",children:[(0,s.jsx)("h3",{className:"font-semibold text-yellow-800",children:"Pending Invitation"}),(0,s.jsxs)("p",{className:"text-yellow-700",children:["This user has a pending invitation that expires on"," ",new Date(d.inviteExpiry).toLocaleDateString()]})]}),(0,s.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),(0,s.jsx)("input",{type:"text",value:p.firstName,onChange:e=>g({...p,firstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),(0,s.jsx)("input",{type:"text",value:p.lastName,onChange:e=>g({...p,lastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,s.jsx)("input",{type:"email",value:p.email,onChange:e=>g({...p,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,s.jsx)("input",{type:"tel",value:p.phone,onChange:e=>g({...p,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(555) 123-4567"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,s.jsxs)("select",{value:p.role,onChange:e=>g({...p,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,s.jsx)("option",{value:"ATTENDANT",children:"Attendant"}),(0,s.jsx)("option",{value:"KEYMAN",children:"Keyman"}),(0,s.jsx)("option",{value:"ASSISTANT_OVERSEER",children:"Assistant Overseer"}),(0,s.jsx)("option",{value:"OVERSEER",children:"Overseer"}),(0,s.jsx)("option",{value:"ADMIN",children:"Admin"})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:p.isActive,onChange:e=>g({...p,isActive:e.target.checked}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"User is active"})]})}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded border border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-800 mb-2",children:"User Information"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Created:"})," ",new Date(d.createdAt).toLocaleString()]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Last Updated:"})," ",new Date(d.updatedAt).toLocaleString()]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Last Login:"})," ",d.lastLogin?new Date(d.lastLogin).toLocaleString():"Never"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{type:"button",onClick:v,className:"bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700",children:"Deactivate User"}),(0,s.jsxs)("div",{className:"space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>c.push("/admin"),className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:x?"Updating...":"Update User"})]})]})]})]})})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"User not found"})})}},9294:function(e,t,a){"use strict";a.d(t,{Providers:function(){return l},a:function(){return i}});var s=a(7437),r=a(2265);let n=(0,r.createContext)(void 0);function i(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[l,o]=(0,r.useState)(!0);(0,r.useEffect)(()=>{c()},[]);let c=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t.user)}}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}},d=async(e,t)=>{try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(a.ok){let e=await a.json();return i(e.user),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},u=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null)}catch(e){console.error("Logout failed:",e)}};return(0,s.jsx)(n.Provider,{value:{user:a,loading:l,login:d,logout:u},children:t})}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[981,971,117,744],function(){return e(e.s=725)}),_N_E=e.O()}]);