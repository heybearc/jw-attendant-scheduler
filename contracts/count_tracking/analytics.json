{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://jw-attendant-scheduler.local/schemas/count_analytics.json",
  "title": "Count Analytics Schema",
  "description": "JSON Schema for Count Analytics output and validation",
  "type": "object",
  "properties": {
    "event_id": {
      "type": "integer",
      "minimum": 1,
      "description": "ID of the event for this analytics report"
    },
    "report_type": {
      "type": "string",
      "enum": ["summary", "trends", "comparison", "detailed"],
      "description": "Type of analytics report"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "When this report was generated"
    },
    "time_range": {
      "type": "object",
      "properties": {
        "start_date": {
          "type": "string",
          "format": "date-time"
        },
        "end_date": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["start_date", "end_date"]
    },
    "summary": {
      "type": "object",
      "properties": {
        "total_sessions": {
          "type": "integer",
          "minimum": 0
        },
        "total_positions": {
          "type": "integer",
          "minimum": 0
        },
        "total_counts": {
          "type": "integer",
          "minimum": 0
        },
        "average_attendance": {
          "type": "number",
          "minimum": 0
        },
        "peak_attendance": {
          "type": "integer",
          "minimum": 0
        },
        "peak_session": {
          "type": "string",
          "description": "Name of session with peak attendance"
        }
      },
      "required": ["total_sessions", "total_positions", "total_counts"]
    },
    "sessions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "integer",
            "minimum": 1
          },
          "session_name": {
            "type": "string"
          },
          "scheduled_time": {
            "type": "string",
            "format": "date-time"
          },
          "total_count": {
            "type": "integer",
            "minimum": 0
          },
          "positions_counted": {
            "type": "integer",
            "minimum": 0
          },
          "completion_percentage": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "variance_from_previous": {
            "type": "number",
            "description": "Percentage change from previous session"
          }
        },
        "required": ["session_id", "session_name", "total_count"]
      }
    },
    "positions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "position_id": {
            "type": "integer",
            "minimum": 1
          },
          "position_name": {
            "type": "string"
          },
          "section": {
            "type": "string"
          },
          "capacity": {
            "type": "integer",
            "minimum": 0
          },
          "counts": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "session_id": {
                  "type": "integer"
                },
                "count": {
                  "type": "integer",
                  "minimum": 0
                },
                "utilization_percentage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                }
              }
            }
          },
          "average_count": {
            "type": "number",
            "minimum": 0
          },
          "peak_count": {
            "type": "integer",
            "minimum": 0
          },
          "average_utilization": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          }
        },
        "required": ["position_id", "position_name", "counts"]
      }
    },
    "trends": {
      "type": "object",
      "properties": {
        "attendance_trend": {
          "type": "string",
          "enum": ["increasing", "decreasing", "stable", "volatile"]
        },
        "trend_percentage": {
          "type": "number",
          "description": "Percentage change over time period"
        },
        "peak_times": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "time"
          }
        },
        "low_times": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "time"
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "generated_by": {
          "type": "integer",
          "minimum": 1
        },
        "export_format": {
          "type": "string",
          "enum": ["json", "csv", "pdf", "xlsx"]
        },
        "filters_applied": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "data_quality": {
          "type": "object",
          "properties": {
            "completeness_percentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "validation_errors": {
              "type": "integer",
              "minimum": 0
            },
            "missing_counts": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    }
  },
  "required": ["event_id", "report_type", "generated_at", "summary"],
  "additionalProperties": false,
  "examples": [
    {
      "event_id": 1,
      "report_type": "summary",
      "generated_at": "2025-09-08T10:00:00Z",
      "time_range": {
        "start_date": "2025-09-08T08:00:00Z",
        "end_date": "2025-09-08T18:00:00Z"
      },
      "summary": {
        "total_sessions": 3,
        "total_positions": 25,
        "total_counts": 1250,
        "average_attendance": 50.0,
        "peak_attendance": 75,
        "peak_session": "Afternoon Count"
      },
      "sessions": [
        {
          "session_id": 1,
          "session_name": "Morning Count",
          "scheduled_time": "2025-09-08T09:00:00Z",
          "total_count": 1200,
          "positions_counted": 25,
          "completion_percentage": 100.0,
          "variance_from_previous": 5.2
        }
      ],
      "trends": {
        "attendance_trend": "increasing",
        "trend_percentage": 8.5,
        "peak_times": ["14:00", "16:30"],
        "low_times": ["09:00", "12:00"]
      }
    }
  ]
}
