(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{3892:function(e,t,r){Promise.resolve().then(r.bind(r,6370))},6370:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var s=r(7437),n=r(9294),a=r(9376),i=r(2265),l=r(7648);function o(){let{user:e,loading:t}=(0,n.a)(),r=(0,a.useRouter)(),[o,u]=(0,i.useState)(!1),[c,d]=(0,i.useState)({email:"",firstName:"",lastName:"",phone:"",role:"ATTENDANT"});(0,i.useEffect)(()=>{if(!t&&(!e||"ADMIN"!==e.role)){r.push("/unauthorized");return}},[e,t,r]);let h=async e=>{e.preventDefault(),u(!0);try{let e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(e.ok)alert("User created and invitation sent successfully!"),r.push("/admin");else{let t=await e.json();alert("Failed to create user: ".concat(t.error))}}catch(e){console.error("Failed to create user:",e),alert("Failed to create user")}finally{u(!1)}};return t?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading..."})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsx)("div",{className:"container mx-auto px-4 max-w-2xl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Add New User"}),(0,s.jsx)(l.default,{href:"/admin",className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Back to Admin"})]}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),(0,s.jsx)("input",{type:"text",value:c.firstName,onChange:e=>d({...c,firstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),(0,s.jsx)("input",{type:"text",value:c.lastName,onChange:e=>d({...c,lastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,s.jsx)("input",{type:"email",value:c.email,onChange:e=>d({...c,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,s.jsx)("input",{type:"tel",value:c.phone,onChange:e=>d({...c,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(555) 123-4567"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,s.jsxs)("select",{value:c.role,onChange:e=>d({...c,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,s.jsx)("option",{value:"ATTENDANT",children:"Attendant"}),(0,s.jsx)("option",{value:"KEYMAN",children:"Keyman"}),(0,s.jsx)("option",{value:"ASSISTANT_OVERSEER",children:"Assistant Overseer"}),(0,s.jsx)("option",{value:"OVERSEER",children:"Overseer"}),(0,s.jsx)("option",{value:"ADMIN",children:"Admin"})]})]}),(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:"What happens next?"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,s.jsx)("li",{children:"• User will be created with the information provided"}),(0,s.jsx)("li",{children:"• An invitation email will be sent automatically"}),(0,s.jsx)("li",{children:"• User can set their password when they accept the invitation"}),(0,s.jsx)("li",{children:"• Invitation expires in 7 days"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{type:"button",onClick:()=>r.push("/admin"),className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:o?"Creating User...":"Create User & Send Invitation"})]})]})]})})})}},9294:function(e,t,r){"use strict";r.d(t,{Providers:function(){return l},a:function(){return i}});var s=r(7437),n=r(2265);let a=(0,n.createContext)(void 0);function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0);(0,n.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t.user)}}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}},c=async(e,t)=>{try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(r.ok){let e=await r.json();return i(e.user),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},d=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null)}catch(e){console.error("Logout failed:",e)}};return(0,s.jsx)(a.Provider,{value:{user:r,loading:l,login:c,logout:d},children:t})}},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[981,971,117,744],function(){return e(e.s=3892)}),_N_E=e.O()}]);