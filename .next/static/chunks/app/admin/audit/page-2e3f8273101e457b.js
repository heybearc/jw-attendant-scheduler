(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{7832:function(e,t,s){Promise.resolve().then(s.bind(s,9406))},9406:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(7437),a=s(9294),n=s(9376),i=s(2265),l=s(7648);function d(){let{user:e,loading:t}=(0,a.a)(),s=(0,n.useRouter)(),[d,o]=(0,i.useState)([]),[c,u]=(0,i.useState)(!0),[x,m]=(0,i.useState)({action:"",severity:"",dateFrom:"",dateTo:"",userId:"",search:""}),[h,g]=(0,i.useState)(1),[p,y]=(0,i.useState)(1),b=[{id:"1",userId:"admin-1",userEmail:"admin@congregation.org",userName:"System Admin",action:"USER_CREATED",resource:"User",resourceId:"user-123",details:"Created new user: John Smith (john.smith@email.com) with role ATTENDANT",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)",timestamp:new Date(Date.now()-18e5).toISOString(),severity:"MEDIUM"},{id:"2",userId:"admin-1",userEmail:"admin@congregation.org",userName:"System Admin",action:"BULK_USER_IMPORT",resource:"User",resourceId:"import-session-456",details:"Imported 25 users via CSV upload",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)",timestamp:new Date(Date.now()-72e5).toISOString(),severity:"HIGH"},{id:"3",userId:"overseer-1",userEmail:"overseer@congregation.org",userName:"John Overseer",action:"LOGIN_SUCCESS",resource:"Authentication",resourceId:"session-789",details:"Successful login from new device",ipAddress:"192.168.1.105",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X)",timestamp:new Date(Date.now()-144e5).toISOString(),severity:"LOW"},{id:"4",userId:"admin-1",userEmail:"admin@congregation.org",userName:"System Admin",action:"EMAIL_CONFIG_UPDATED",resource:"EmailConfiguration",resourceId:"config-1",details:"Updated SMTP configuration settings",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)",timestamp:new Date(Date.now()-216e5).toISOString(),severity:"MEDIUM"},{id:"5",userId:"unknown",userEmail:"unknown@attacker.com",userName:"Unknown User",action:"LOGIN_FAILED",resource:"Authentication",resourceId:"failed-attempt-999",details:"Failed login attempt with invalid credentials (5th attempt)",ipAddress:"203.0.113.45",userAgent:"curl/7.68.0",timestamp:new Date(Date.now()-288e5).toISOString(),severity:"CRITICAL"}];(0,i.useEffect)(()=>{if(!t){if(!e||"ADMIN"!==e.role){s.push("/unauthorized");return}o(b),y(1),u(!1)}},[e,t,s]);let j=e=>{switch(e){case"CRITICAL":return"bg-red-100 text-red-800 border-red-200";case"HIGH":return"bg-orange-100 text-orange-800 border-orange-200";case"MEDIUM":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"LOW":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},N=e=>{switch(e){case"USER_CREATED":return"\uD83D\uDC64➕";case"USER_UPDATED":return"\uD83D\uDC64✏️";case"USER_DELETED":return"\uD83D\uDC64❌";case"BULK_USER_IMPORT":return"\uD83D\uDCE5\uD83D\uDC65";case"LOGIN_SUCCESS":return"\uD83D\uDD13✅";case"LOGIN_FAILED":return"\uD83D\uDD12❌";case"EMAIL_CONFIG_UPDATED":return"\uD83D\uDCE7⚙️";case"ROLE_CHANGED":return"\uD83D\uDD04\uD83D\uDC64";case"SYSTEM_SETTINGS_UPDATED":return"⚙️✏️";default:return"\uD83D\uDCDD"}},f=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<60?"".concat(r," minutes ago"):a<24?"".concat(a," hours ago"):n<7?"".concat(n," days ago"):t.toLocaleDateString()};return t||c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg",children:"Loading..."})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"container mx-auto px-4 max-w-7xl",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Audit & Security Logs"}),(0,r.jsx)(l.default,{href:"/admin",className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Back to Admin"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-red-800",children:"Critical Events"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-red-700",children:d.filter(e=>"CRITICAL"===e.severity).length}),(0,r.jsx)("p",{className:"text-xs text-red-600",children:"Last 24 hours"})]}),(0,r.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-orange-800",children:"Failed Logins"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-700",children:d.filter(e=>"LOGIN_FAILED"===e.action).length}),(0,r.jsx)("p",{className:"text-xs text-orange-600",children:"Last 24 hours"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-blue-800",children:"User Actions"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:d.filter(e=>e.action.includes("USER_")).length}),(0,r.jsx)("p",{className:"text-xs text-blue-600",children:"Last 24 hours"})]}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-green-800",children:"Total Events"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-700",children:d.length}),(0,r.jsx)("p",{className:"text-xs text-green-600",children:"Last 24 hours"})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"Filters"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Action"}),(0,r.jsxs)("select",{className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",value:x.action,onChange:e=>m({...x,action:e.target.value}),children:[(0,r.jsx)("option",{value:"",children:"All Actions"}),(0,r.jsx)("option",{value:"USER_CREATED",children:"User Created"}),(0,r.jsx)("option",{value:"LOGIN_FAILED",children:"Login Failed"}),(0,r.jsx)("option",{value:"EMAIL_CONFIG_UPDATED",children:"Email Config"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Severity"}),(0,r.jsxs)("select",{className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",value:x.severity,onChange:e=>m({...x,severity:e.target.value}),children:[(0,r.jsx)("option",{value:"",children:"All Levels"}),(0,r.jsx)("option",{value:"CRITICAL",children:"Critical"}),(0,r.jsx)("option",{value:"HIGH",children:"High"}),(0,r.jsx)("option",{value:"MEDIUM",children:"Medium"}),(0,r.jsx)("option",{value:"LOW",children:"Low"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"From Date"}),(0,r.jsx)("input",{type:"date",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",value:x.dateFrom,onChange:e=>m({...x,dateFrom:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"To Date"}),(0,r.jsx)("input",{type:"date",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",value:x.dateTo,onChange:e=>m({...x,dateTo:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search"}),(0,r.jsx)("input",{type:"text",placeholder:"User, IP, details...",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",value:x.search,onChange:e=>m({...x,search:e.target.value})})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)("button",{className:"w-full bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"Apply Filters"})})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full table-auto",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b",children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP Address"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:[(0,r.jsx)("div",{children:f(e.timestamp)}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),(0,r.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.userName}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.userEmail})]}),(0,r.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"mr-2",children:N(e.action)}),(0,r.jsx)("span",{className:"font-medium",children:e.action.replace(/_/g," ")})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.resource})]}),(0,r.jsx)("td",{className:"px-4 py-4 text-sm text-gray-900 max-w-xs",children:(0,r.jsx)("div",{className:"truncate",title:e.details,children:e.details})}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-mono",children:e.ipAddress}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded border ".concat(j(e.severity)),children:e.severity})})]},e.id))})]})}),(0,r.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",d.length," entries"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{disabled:1===h,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50",children:"Previous"}),(0,r.jsx)("span",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",children:h}),(0,r.jsx)("button",{disabled:h===p,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50",children:"Next"})]})]}),(0,r.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Audit logs are retained for 90 days and automatically archived."}),(0,r.jsxs)("div",{className:"space-x-2",children:[(0,r.jsx)("button",{disabled:!0,className:"bg-gray-300 text-gray-500 px-4 py-2 rounded text-sm cursor-not-allowed",children:"Export CSV (Coming Soon)"}),(0,r.jsx)("button",{disabled:!0,className:"bg-gray-300 text-gray-500 px-4 py-2 rounded text-sm cursor-not-allowed",children:"Generate Report (Coming Soon)"})]})]})})]})})})}},9294:function(e,t,s){"use strict";s.d(t,{Providers:function(){return l},a:function(){return i}});var r=s(7437),a=s(2265);let n=(0,a.createContext)(void 0);function i(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[s,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{o()},[]);let o=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t.user)}}catch(e){console.error("Auth check failed:",e)}finally{d(!1)}},c=async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(s.ok){let e=await s.json();return i(e.user),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},u=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null)}catch(e){console.error("Logout failed:",e)}};return(0,r.jsx)(n.Provider,{value:{user:s,loading:l,login:c,logout:u},children:t})}},9376:function(e,t,s){"use strict";var r=s(5475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[981,971,117,744],function(){return e(e.s=7832)}),_N_E=e.O()}]);