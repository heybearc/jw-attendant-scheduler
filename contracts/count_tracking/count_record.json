{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://jw-attendant-scheduler.local/schemas/count_record.json",
  "title": "Count Record Schema",
  "description": "JSON Schema for Count Record creation and validation",
  "type": "object",
  "properties": {
    "session_id": {
      "type": "integer",
      "minimum": 1,
      "description": "ID of the count session this record belongs to"
    },
    "position_id": {
      "type": "integer",
      "minimum": 1,
      "description": "ID of the position being counted"
    },
    "count": {
      "type": "integer",
      "minimum": 0,
      "maximum": 10000,
      "description": "Number of attendees counted for this position"
    },
    "notes": {
      "type": "string",
      "maxLength": 500,
      "description": "Optional notes about this count record"
    },
    "recorded_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime when the count was recorded"
    },
    "recorded_by": {
      "type": "integer",
      "minimum": 1,
      "description": "User ID who recorded this count"
    },
    "validation_status": {
      "type": "string",
      "enum": ["pending", "validated", "flagged", "corrected"],
      "default": "pending",
      "description": "Validation status of the count record"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "position_name": {
          "type": "string",
          "description": "Name of the position for reference"
        },
        "section": {
          "type": "string",
          "description": "Section or area of the position"
        },
        "capacity": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum capacity for this position"
        },
        "previous_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Count from previous session for comparison"
        },
        "variance_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.2,
          "description": "Acceptable variance from previous count (0.2 = 20%)"
        },
        "entry_method": {
          "type": "string",
          "enum": ["manual", "cli", "import", "api"],
          "default": "manual",
          "description": "Method used to enter this count"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["session_id", "position_id", "count", "recorded_by"],
  "additionalProperties": false,
  "examples": [
    {
      "session_id": 123,
      "position_id": 456,
      "count": 25,
      "notes": "Full capacity, some standing",
      "recorded_at": "2025-09-08T09:15:00Z",
      "recorded_by": 1,
      "validation_status": "validated",
      "metadata": {
        "position_name": "Main Hall - Section A",
        "section": "A",
        "capacity": 30,
        "previous_count": 23,
        "entry_method": "manual"
      }
    }
  ]
}
