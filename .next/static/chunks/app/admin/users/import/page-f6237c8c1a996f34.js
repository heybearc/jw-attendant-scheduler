(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{1185:function(e,t,s){Promise.resolve().then(s.bind(s,9304))},9304:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(7437),a=s(9294),l=s(9376),n=s(2265),i=s(7648);function c(){let{user:e,loading:t}=(0,a.a)(),s=(0,l.useRouter)(),[c,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),[h,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!t&&(!e||"ADMIN"!==e.role)){s.push("/unauthorized");return}},[e,t,s]);let b=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?p(!0):"dragleave"===e.type&&p(!1)},f=async()=>{try{let e=await fetch("/api/admin/users/import");if(e.ok){let t=await e.blob(),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download="user_import_template.csv",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}}catch(e){console.error("Failed to download template:",e),alert("Failed to download template")}},j=async()=>{if(!c){alert("Please select a file to import");return}u(!0);try{let e=new FormData;e.append("file",c);let t=await fetch("/api/admin/users/import",{method:"POST",body:e}),s=await t.json();x(s),s.success&&alert("Successfully imported ".concat(s.successCount," users!"))}catch(e){console.error("Failed to import users:",e),alert("Failed to import users")}finally{u(!1)}},g=()=>{d(null),x(null)};return t?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg",children:"Loading..."})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"container mx-auto px-4 max-w-4xl",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Import Users"}),(0,r.jsx)(i.default,{href:"/admin",className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Back to Admin"})]}),!m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded",children:[(0,r.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:"Before You Start"}),(0,r.jsxs)("ol",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("li",{children:"1. Download the CSV template below"}),(0,r.jsx)("li",{children:"2. Fill in your user data following the template format"}),(0,r.jsx)("li",{children:"3. Required fields: firstName, lastName, email, role"}),(0,r.jsx)("li",{children:"4. Valid roles: ADMIN, OVERSEER, ASSISTANT_OVERSEER, KEYMAN, ATTENDANT"}),(0,r.jsx)("li",{children:"5. Upload your completed CSV file"})]})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("button",{onClick:f,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 flex items-center",children:"\uD83D\uDCE5 Download CSV Template"})}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload CSV File"}),(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center ".concat(h?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),p(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){let t=e.dataTransfer.files[0];t.name.endsWith(".csv")?(d(t),x(null)):alert("Please select a CSV file")}},children:[(0,r.jsx)("input",{type:"file",accept:".csv",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];t.name.endsWith(".csv")?(d(t),x(null)):alert("Please select a CSV file")}},className:"hidden",id:"file-upload"}),(0,r.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:(0,r.jsxs)("div",{className:"text-gray-600",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsx)("p",{className:"mt-2 text-lg",children:c?c.name:"Drag and drop your CSV file here, or click to select"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"CSV files only"})]})})]})]}),c&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded",children:[(0,r.jsx)("h3",{className:"font-semibold text-green-800",children:"File Selected"}),(0,r.jsxs)("p",{className:"text-green-700",children:[c.name," (",(c.size/1024).toFixed(1)," KB)"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:g,className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",disabled:!c,children:"Clear"}),(0,r.jsx)("button",{onClick:j,disabled:!c||o,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:o?"Importing...":"Import Users"})]})]}),m&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"p-4 rounded border ".concat(m.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[(0,r.jsxs)("h3",{className:"font-semibold ".concat(m.success?"text-green-800":"text-red-800"),children:["Import ",m.success?"Successful":"Failed"]}),(0,r.jsx)("p",{className:m.success?"text-green-700":"text-red-700",children:m.success?"Successfully imported ".concat(m.successCount," users and sent invitation emails."):"Found ".concat(m.errorCount," errors in ").concat(m.totalRows," rows.")})]}),m.success&&m.createdUsers.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800 mb-4",children:"Imported Users"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full table-auto border border-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Name"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Email"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Role"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Invitation"})]})}),(0,r.jsx)("tbody",{children:m.createdUsers.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsxs)("td",{className:"px-4 py-2",children:[e.firstName," ",e.lastName]}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.email}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:e.role})}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(e.emailSent?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.emailSent?"Sent":"Failed"})})]},t))})]})})]}),!m.success&&m.errors.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-red-800 mb-4",children:"Validation Errors"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full table-auto border border-red-200",children:[(0,r.jsx)("thead",{className:"bg-red-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Row"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Field"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Error"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left border-b",children:"Value"})]})}),(0,r.jsx)("tbody",{children:m.errors.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("td",{className:"px-4 py-2",children:e.row}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-sm",children:e.field}),(0,r.jsx)("td",{className:"px-4 py-2 text-red-700",children:e.message}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-sm bg-gray-100",children:e.value||"(empty)"})]},t))})]})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:g,className:"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600",children:"Import Another File"}),(0,r.jsx)(i.default,{href:"/admin",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Back to Admin Dashboard"})]})]})]})})})}},9294:function(e,t,s){"use strict";s.d(t,{Providers:function(){return i},a:function(){return n}});var r=s(7437),a=s(2265);let l=(0,a.createContext)(void 0);function n(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function i(e){let{children:t}=e,[s,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();n(t.user)}}catch(e){console.error("Auth check failed:",e)}finally{c(!1)}},o=async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(s.ok){let e=await s.json();return n(e.user),!0}return!1}catch(e){return console.error("Login failed:",e),!1}},u=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),n(null)}catch(e){console.error("Logout failed:",e)}};return(0,r.jsx)(l.Provider,{value:{user:s,loading:i,login:o,logout:u},children:t})}},9376:function(e,t,s){"use strict";var r=s(5475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[981,971,117,744],function(){return e(e.s=1185)}),_N_E=e.O()}]);